(()=>{"use strict";const e=window.wp.blocks,l=window.wp.i18n,s=window.wp.blockEditor,t=window.wp.components,i=window.wp.element,a=window.ReactJSXRuntime,r=[{name:"Green",color:"#38ff00"},{name:"Blue",color:"#0073e6"},{name:"Red",color:"#e60023"},{name:"Gray",color:"#cccccc"},{name:"Black",color:"#222222"}],o=[14,16,18,20,24,28];(0,e.registerBlockType)("create-block/mailist-subscribe-block",{edit:({attributes:e,setAttributes:n})=>{const{listId:c,button_color:b,font_size:u,label_email:d,label_button:_,label_consent:m,privacy_policy_url:p,label_privacy_link:y,label_success:g,label_error:h,label_already:x}=e,[f,v]=(0,i.useState)(""),[k,j]=(0,i.useState)(""),[C,S]=(0,i.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s.InspectorControls,{children:[(0,a.jsxs)(t.PanelBody,{title:(0,l.__)("Settings","mailist-subscribe-block"),children:[(0,a.jsx)(t.TextControl,{label:(0,l.__)("List ID","mailist-subscribe-block"),value:c,onChange:e=>n({listId:e})}),(0,a.jsx)(t.TextControl,{label:(0,l.__)("Email Label","mailist-subscribe-block"),value:d,onChange:e=>n({label_email:e})}),(0,a.jsx)(t.TextControl,{label:(0,l.__)("Button Text","mailist-subscribe-block"),value:_,onChange:e=>n({label_button:e})}),(0,a.jsx)(t.TextControl,{label:(0,l.__)("Consent Text","mailist-subscribe-block"),value:m,onChange:e=>n({label_consent:e})}),(0,a.jsx)(t.TextControl,{label:(0,l.__)("Privacy Policy URL","mailist-subscribe-block"),value:p,onChange:e=>n({privacy_policy_url:e})}),(0,a.jsx)(t.TextControl,{label:(0,l.__)("Privacy Link Text","mailist-subscribe-block"),value:y,onChange:e=>n({label_privacy_link:e})}),(0,a.jsx)(t.TextControl,{label:(0,l.__)("Success Message","mailist-subscribe-block"),value:g,onChange:e=>n({label_success:e})}),(0,a.jsx)(t.TextControl,{label:(0,l.__)("Error Message","mailist-subscribe-block"),value:h,onChange:e=>n({label_error:e})}),(0,a.jsx)(t.TextControl,{label:(0,l.__)("Already Subscribed Message","mailist-subscribe-block"),value:x,onChange:e=>n({label_already:e})})]}),(0,a.jsxs)(t.PanelBody,{title:(0,l.__)("Appearance","mailist-subscribe-block"),initialOpen:!1,children:[(0,a.jsx)("p",{children:(0,l.__)("Button Color","mailist-subscribe-block")}),(0,a.jsx)(t.ColorPalette,{colors:r,value:b,onChange:e=>n({button_color:e})}),(0,a.jsx)("p",{children:(0,l.__)("Font Size","mailist-subscribe-block")}),(0,a.jsx)(t.FontSizePicker,{fontSizes:o.map((e=>({name:`${e}px`,slug:`${e}`,size:e}))),value:u,onChange:e=>n({font_size:e})})]})]}),(0,a.jsx)("div",{...(0,s.useBlockProps)(),children:(0,a.jsxs)("form",{className:"mailist-subscribe-form","data-list-id":c,style:{fontSize:u?`${u}px`:void 0},onSubmit:e=>{e.preventDefault();const s=e.target.email.value,t=e.target["gdpr-consent"].checked;if(!t)return v(h||"You must consent to data storage to subscribe."),void j("error");S(!0),v(""),j(""),fetch("https://mailist.luova.club/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,list_id:c,gdpr_consent:t})}).then((e=>e.json())).then((e=>{e.success?(v(g||"Subscription successful!"),j("success")):409===e.status||409===e.code?(v(x||(0,l.__)("This user might have already subscribed","mailist-subscribe-block")),j("error")):(v(e.message&&"string"==typeof e.message?e.message:h||"Subscription failed."),j("error"))})).catch((()=>{v(h||"An error occurred. Please try again."),j("error")})).finally((()=>{S(!1)}))},children:[(0,a.jsx)("label",{htmlFor:"email",children:d||(0,l.__)("Email:","mailist-subscribe-block")}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",required:!0}),(0,a.jsx)("br",{}),(0,a.jsxs)("label",{htmlFor:"gdpr-consent",style:{display:"flex",alignItems:"center",fontSize:"0.95em"},children:[(0,a.jsx)("input",{type:"checkbox",id:"gdpr-consent",name:"gdpr_consent",required:!0,style:{marginRight:"0.5em"}}),m||(0,l.__)("I consent to having my email stored and used to receive updates. See our ","mailist-subscribe-block"),(0,a.jsx)("a",{href:p||"/privacy-policy",target:"_blank",rel:"noopener noreferrer",children:y||(0,l.__)("Privacy Policy","mailist-subscribe-block")}),"."]}),(0,a.jsx)("br",{}),f&&(0,a.jsx)("div",{className:`mailist-notification ${k}`,children:f}),(0,a.jsx)("button",{type:"submit",style:{backgroundColor:b||"#38ff00"},disabled:C,children:C?(0,l.__)("Subscribing...","mailist-subscribe-block"):_||(0,l.__)("Subscribe","mailist-subscribe-block")})]})})]})},attributes:{listId:{type:"string",default:"67617934a04a83ee026352d3"},button_color:{type:"string",default:"#38ff00"},font_size:{type:"number",default:16},label_email:{type:"string",default:"Email:"},label_button:{type:"string",default:"Subscribe"},label_consent:{type:"string",default:"I consent to having my email stored and used to receive updates. See our "},privacy_policy_url:{type:"string",default:"/privacy-policy"},label_privacy_link:{type:"string",default:"Privacy Policy"},label_success:{type:"string",default:"Subscription successful!"},label_error:{type:"string",default:"Subscription failed."},label_already:{type:"string",default:"This user might have already subscribed"}}})})();